---
import Main from './Main.astro';
import { Image } from 'astro:assets';
import type { MarkdownLayoutProps } from 'astro';
import { getBlogs } from '../utils/getBlogs';
import { t } from 'astro-i18n';

type Props = MarkdownLayoutProps<{
  title: string;
  subtitle: string;
  poster: string;
}>;

const { title, subtitle, poster } = Astro.props.frontmatter;

const blogs = await getBlogs();
const otherBlogs = blogs.filter(({ data }) => {
  return title !== data.title;
});
---

<Main title=`Ginlon | ${title}`>
  <header
    class="relative w-full h-64 bg-gray-800 flex items-center justify-center mb-12"
  >
    <Image
      src={poster}
      alt="Poster image"
      width={1024}
      height={480}
      class="absolute inset-0 w-full h-full object-cover opacity-50"
    />
    <div class="relative z-10 text-center">
      <h1 class="text-4xl font-bold text-white dark:text-grey-900">
        {title}
      </h1>
      {
        subtitle && (
          <h2 class="text-2xl text-gray-300 dark:text-grey-600">{subtitle}</h2>
        )
      }
    </div>
  </header>

  <div class="container mx-auto px-4 lg:px-8">
    <article class="prose">
      <slot />
    </article>
  </div>

  <aside class="w-full bg-[--bg-grey-100] p-4 mt-12">
    <h3 class="text-2xl font-semibold mb-4 dark:text-grey-400">
      {t('blogs.recentPosts')}
    </h3>
    <ul class="list-none p-0">
      {
        otherBlogs.map(({ data: { permalink, title, createdAt } }) => (
          <li class="mb-2">
            <a href={permalink} class="">
              {title}
            </a>
            {createdAt && (
              <span class="block text-sm text-gray-500 dark:text-grey-600 mt-1">
                {new Date(createdAt).toLocaleDateString()}
              </span>
            )}
          </li>
        ))
      }
    </ul>
  </aside>
</Main>
